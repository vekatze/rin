import {
  core.text {_get-content-pointer},
  this.handle {handle},
  this.rin {_wrap-curl-code, rin},
}

foreign {
  curl_global_init(pointer): int,
  curl_easy_init(): int,
  curl_easy_cleanup(pointer): void,
  curl_easy_setopt(pointer, int): int,
  curl_easy_getinfo(pointer, int): int,
  curl_easy_perform(pointer): int,
  curl_easy_strerror(int): pointer,
  curl_slist_append(pointer, pointer): pointer,
  curl_slist_free_all(pointer): void,
}

define _curl_easy_setopt(h: handle, option: int, parameter: int): rin(unit) {
  // cf: CURLcode curl_easy_setopt(struct Curl_easy *data, CURLoption tag, ...)
  let code = magic external curl_easy_setopt(h, option)(parameter: int) in
  _wrap-curl-code(code, Unit)
}

define _curl_easy_setopt_text(h: handle, option: int, parameter: &text): rin(unit) {
  let content = _get-content-pointer(parameter) in
  let code = magic external curl_easy_setopt(h, option)(content: int) in
  _wrap-curl-code(code, Unit)
}
